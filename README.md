# Passenger Exporter

Passenger exporter is a [Prometheus] metrics exporter for [Phusion Passenger] 6.0.

## Usage

### Running locally
Start Passenger with a known [instance registry]:
```console
$ PASSENGER_INSTANCE_REGISTRY_DIR=/tmp/passenger passenger start
```

Run the exporter, specifying the same [instance registry]:
```console
$ PASSENGER_INSTANCE_REGISTRY_DIR=/tmp/passenger ./bin/passenger-exporter
```

**Note**: You must specify the [`PASSENGER_INSTANCE_REGISTRY_DIR`] environment variable. It is used by the [`passenger-status`] command to query Passenger information. Without it, the exporter cannot retreve metrics from your Passenger instance.

### Flags

The following flags are available:

| Flag                                    | Description                                            | Default Value              |
|-----------------------------------------|--------------------------------------------------------|----------------------------|
| `-passenger.command string`             | Passenger command for querying passenger status.      | `"passenger-status --show=xml"` |
| `-passenger.command.timeout-seconds float` | Timeout for passenger.command.                       | `5`                  |
| `-web.listen-address string`            | Address to listen on for web interface and telemetry. | `":9149"`                   |
| `-web.telemetry-path string`            | Path under which to expose metrics.                   | `"/metrics"`                |


## Building

1. Clone the repository.
2. Install the [`promu`] build tool.
2. Install application dependencies via `make dependencies` (they'll be placed in `./vendor`).
3. Build and install the binary with `make build`.
4. Run the command e.g. `./bin/passenger-exporter -h`.

## Testing

1. Install the `golangci-lint`, [see instructions here][golangci-lint-install].
2. Run linter using `make lint` and test using `make test`.

The scrape output can be regenerated by passing the `--golden` flag to `go test`.

## Credits

We would like to acknowledge and express our gratitude to [@stuartnelson3] for their work on the [upstream version of Passenger Exporter].

[`PASSENGER_INSTANCE_REGISTRY_DIR`]: https://www.phusionpassenger.com/library/config/standalone/reference/#--instance-registry-dir-instance_registry_dir
[`passenger-status`]: https://www.phusionpassenger.com/library/admin/standalone/overall_status_report.html
[`promu`]: github.com/prometheus/promu
[golang-quickstart]: https://go.dev/doc/tutorial/getting-started
[golangci-lint-install]: https://golangci-lint.run/usage/install/
[Phusion Passenger]: https://www.phusionpassenger.com/
[Prometheus]: https://prometheus.io/
[instance registry]: https://www.phusionpassenger.com/library/config/standalone/reference/#--instance-registry-dir-instance_registry_dir
[upstream version of Passenger Exporter]: https://github.com/stuartnelson3/passenger_exporter
[@stuartnelson3]: https://github.com/stuartnelson3/
